# NPR

### Категория: Forensics
### Сложность: hard

##### Описание:

NSA, PDF, RSA... Как все это может быть связано?

##### Решение:

1. У нас есть один PDF файл, 170 страниц, ничего не распаковывается с помощью ```binwalk```.
2. Каждый из них содержит текст, который зашифрован с помощью RSA. Мы можем расшифровать его, только зная один из факторов N.
3. Но так как числа очень большие, это вряд ли возможно с текущими компьютерами.
4. Если немного подумать об описании таска, и поискать в интернете, то можно найти утилиту [deda](https://github.com/dfd-tud/deda).
5. Да, можно получить информацию из желтых точек.
6. ![1](https://i.ibb.co/0DBdSP1/1.jpg)
7. Если вытащить серийный номер из каждой страницы, можно увидеть, что они разные...
8. Но если сконкатенировать все числа, то это может быть один из факторов N.
9. Программное решение:

```python
import os
import gmpy2
import codecs

os.system('rm -rf *.png')
os.system('pdftoppm task.pdf rsa -png')

prime = ""

for i in range(1, 171):
    command = "deda_parse_print rsa-{:03d}.png | grep 'serial' | grep -Eo ".format(i)
    command += "'[0-9]{6}'"
    io = os.popen(command).read().strip('\n')
    prime += io

p = int(prime)

c = 6096330819648415012560923324243333424295293819678779477456587645310202709563715530695529157925043997406148756633132258786518092946638819351584453272597100284707415153334664354704660562345807796572953518796331901196190810486091848033548549219542193176600641123602698807752449959314076534638441530315101947765723200544928715739468542954618931006209514132210630600420976827519047261756146208387140019520348627669190011093827869163613131352181865466888938534914032480025990377487345217975356362644389436540387563480894515263352636941579341717858216901050923228533178922089074625973485464779205147113693203088958501272689330176990507019360518678347849157138525690136098671073633561851672092888838501148307327654092025908908613408976821595680179169211228309227787353127716211682181920926474170292317284177289118851631085963574592325173213156843986379245992933338381590142851265664379824537940019362278637751492523335204678513236659924501050611110349162694195939181412480855616594092216256067814120319524236556077540326841296391416278853466801305608628210639194911317957167867251183679651341302270834397860968543012177333438863500001114257439273464386478758501405474838094359608909055955777617174189089510624436848542135435428512484071211251235280432189397356166877776305894918788766824418267103026251527696795205363728152517402055204799686577382061975641968526626184445143867299079052479518311039854576246620739839312730795297903798823400955437695428854182741436765485993231023211281023786162254001282144115418228358191007219488130878615471743001132938244988522147692718678159835971208701148499881572263784412537104659083083349964332599990663322252806830748302866197259323092624029540237208607857014526212319360850385121304242324546757001181584724127094117575402719443080684436368411349161914657907267380644511275800371516533302455387898239523527414321172798265100729911255739098304389241540230292653458514278606783238144944027645350790324954151072728340809243196896568974096155561315536084752919931347059832344032595777977472572305220265782632
e = 65537
n = 21461298315795389206829436379663984805806252889820433930305469960565968868090459486447453604206496328505059070420199595737206740984983526414046707257084249864576878298025217475301999674781276715115202017942286178827902611350232299424628531023202366411660566366901074515663761060361683424706891848801038767478180373137285257747517170128829403225717837834593274107198549319406762406718149194516230481000862702954292129649650009430382457304242566147081887999478751978632497788337937822644443385808255086327505439394096482033700688708488758643950719758881158655958857151930674571652164657186512587985781305432137533462140499557377337867753191634659408803805300834776402431557971063392826648086114912130658403630093314160329355705731404261317742262804349091449578179126722923043651180660972717479468387382909436140522081303228633085089082888341311781370347952908411455985224278447243969962731781908369408201589052198757523405384951535443746832659438560041633698389224209592863465271838560626584509909019235821409385678189584264585088081903766914767146319453779857163545964140147980096829756042891999542042211781367938899800608959679946370127791253464676727915814037145083091735281231742910925189813865847808213253166691065654101479389112637379716237102360452046867648827720424214138386759035252739687303944202680567561102087698552231237681990719910559755893252027726817028074534292033278318868876008744570437805940624361743168871139058609200302109598601920781259216546919092567268866452176523993353788055987473412985875309723237513759672915071794223798854381253307493213658009209402059130870446566048353355138920528716639168543875122368418840403753968163669423031359229622215177958209406431437241699574458614516683245840166547077005935972160428760540797612567523995431241145395077588565256310401450667101148589422150756612221038676798884283241807984201989418554044047854232593954225714353031592777242494443783468761111867761832784730342916656281486530664904249666793906175965641028234710412180214988257197664880497302465543261462879790903816437

q = n // p

phi = 1
phi *= (p - 1)
phi *= (q - 1)
d = gmpy2.invert(e, phi)
m = pow(c, d, n)
print(codecs.decode(('%x' % m), 'hex_codec'))
```

10. И получаем флаг: ```ctfcup{W0rk1N6_1N_l4W_3nf0rC3m3N7_15_4lW4Y5_D4n63R0uSSS...}```
